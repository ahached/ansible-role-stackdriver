---
- name: "[RedHat] Add the Google Stackdriver monitoring yum repository."
  yum_repository:
    name: google-cloud-monitoring
    baseurl: "{{ stackdriver_monitoring_repo }}-$basearch"
    description: A google repo that contains monitoring stuff
    gpgkey: https://packages.cloud.google.com/yum/doc/yum-key.gpg,https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
    gpgcheck: yes
    enabled: yes
    repo_gpgcheck: yes

- name: "[RedHat] Add the Google Stackdriver logging yum repository."
  yum_repository:
    name: google-cloud-logging
    baseurl: "{{ stackdriver_logging_repo }}-$basearch"
    description: A google repo that contains logging stuff
    gpgkey: https://packages.cloud.google.com/yum/doc/yum-key.gpg,https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
    gpgcheck: yes
    enabled: yes
    repo_gpgcheck: yes

- name: "[RedHat] Install the Stackdriver agent."
  yum:
    name: "{{ stackdriver_collectd_package }}"
    state: present
  notify: restart-stackdriver-agent

  - name: "[RedHat] restart-stackdriver-agent"
    systemd:
      state: started
      daemon_reload: yes
      name: "{{ stackdriver_collectd_service }}"
      enabled: yes
